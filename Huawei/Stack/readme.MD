# Stack Hua
## Сброс свича
• Если знаем пароль - логинимся и 
```
reset saved-config
reboot
```
• Если не знаем пароль - гуглим сброс по-питанию:
```
ctrl+B
pass = Admin@huawei.com или 9300, если версия V100R006
clear password for console user
Boot with default mode
перезагрузка 
system-view
user-interface console 0
authentication-mode password
set authentication password cipher <password>
return
save
reboot
```

## Общие понятия
• member - члены стека, их может быть до 9

• топология - 2 вида: кольцевая, цепочка

• Master - только 1 в стеке, назначает member-ам Stack-ID, управляет стеком

• Standby - только 1 в стеке, принимает на себя роль master, если тот отвалится.

• Slave - отправляет master-у оповещения о потере соседа

Протокол стекирования обеспечивает выборы master, Standby. После выборов, master будет управлять стеком, назначая Stack-ID всем member-ам, отслеживать топологию, оповещать member-ов об изменении топологии.
Требования:
• проверить версию ПО. Master может захотеть поставить правильную версию на нового member-а

• использовать устройства одного типа (EI/SI...)

• Подключать используя стековые модули/кабели

• Проверить что функция стека включена нак всех устройствах

Особенности выбора master
• Первое включенное устройство - становится мастером

• Если устройства включаются одновременно - между ними происходят выборы и побеждает устройство с максимальным priority. Если приоритет не конфигурировался, то побеждает устройство с минимальным MAC. MAC этого устройства становится MAC стека.

Особенности выбора Standby
• Если все кроме master включаются одновременно, то standby будет подключенный к Stack IF2

• Если к Stack IF2 никто не подключен, то standby будет тот, кто подключен к Stack IF1 member-а

Добавление нового member-а в работающий стека
Возможно только в случае нормального функционирования стека. Добавление возможно в 2 режимах: power-on; power-off. Текущее руководство рассматривает power-off, так как power-on относится к режиму слияния двух стеков. 
При power-off свич выключается, коммутируется стековыми кабелями к работающему стеку и только затем включается. Добавление member-а не отражается на master. Все предыдущие настройки - сбрасываются. Если Stack-ID нового свича конфликтует с Stack-ID какого-либо member-а, то master переназначает новому свичу Stack-ID

Удаление свича из стека
• Если master удаляется из стека, соседи обнаруживают это и информируют своих соседей. Standby становится master-ом, назначает нового standby и уточняет топологию с последующим оповещением member-ов.

• Если Standby удаляется, то master переназначает standby и уточняет топологию с последующим оповещением member-ов.

• Если Master и Standby одновременно удаляется, то оставшиеся member рестартуют и пытаются пересоздать стек. 
Во всех случаях меняется MAC стека, если выключена функция switchover. По-умолчанию она включена и время смены MAC составляет 10 минут, на тот случай, если отвалившийся свич заново подключится к стеку. В этом случае, MAC стека не поменяется, а отвалившийся свич станет уже slave-ом. 

## этапы настройки
• на этапе конфигурации новго стека все происходит автоматически, стоит выключить свичи и скоммутировать их стековыми DAC-кабелями
```
display stack
display device
display stack peers
display stack port
display stack channel all
	
```

• Если кто-то отключил стекирование на портах, то включаем его на каждом из слотов, и stack-port-ах
```
display stack configuration
interface stack-port x/Y
	port interface XGigabitEthernetx/y/z enable
```
• 
• 

![](pictures/M3_l2_1.jpg)
