Рассматривается раздел политик безопасности, включающий в себя инспектирование SSL, фильтрацию контента и веб-безопасность. Контентная фильтрация и контроль приложений - то ради чего изобретались NGFW

# Списки URL
Все просто, если понимать [инструкцию буквально](https://support.usergate.com/ru/docs/version/6x/usergate-6/116-spiski-url)
Доступны 2 типа списков:
- ручной (задаем URL вручную, в поле справа от названий списков)
- Обновляемый (задаем файл, содержащий URL)
![](Pictures/image_20250109221519.png)
При этом структура файлов в каталоге с фильтром должна содержать следующие файлы
- list.zip - Список URL заархивированный zip
- version.txt - файл версий, в котором надо менять номер при изменении list.zip
# Инспектирование SSL
## Принцип MITM
Необходимо для контроля данных которыми пользователь обменивается с WEB-ресурсами. Принцип работы - атака MITM, при этом для успешной работы необходимо распространение сертификата **subordinate certificate CA**, который будет использоваться для генерации SSL-сертификатов интернет-хостов. UserGate поставляется с набором сертификатов среди которых есть CA (Default) — это сертификат для инспектирования SSL. Его можно скачать [по прямой ссылке со шлюза](http:// UserGate_IP:8002/cps/ca)
CA сертификат может быть как контроллера домена, так и subordinate, если в домене сделано все по науке и есть промежуточные CA
![](Pictures/image_20250110222610.png)
![](Pictures/image_20250109151805.png)
## Где все это лежит
![](Pictures/image_20250109151922.png)
При помощи политик, админ может разрешить/запретить контент пользователям

## Настройка инспектирования
Основное что мы делаем при создании правила
- расшифровываем или нет.
![](Pictures/image_20250109152543.png)
- дополнительно выделен 2 набор атрибутов, которые относятся к срабатыванию правила
С настройками вкладок №2, 3, 4 все понятно
- Пользователь
- Источник (Зона Trusted)
- Адрес назначения (списки IP-адресов)
С вкладками 5, 6, 7 - чуть сложнее 
- Сервисы - выбор HTTPS/SMTPS/POP3S
- Категории - выбор по дефолтным категориям, можно даже проверить к какой категории принадлежит сайт, работает только если **есть валидная лицензия**
- Домены - список доменных имен, содержащий конкретные названия доменных имен: ([www.example.com](http://www.example.com?roistat_visit=1158321), а не [http://www.example.com/home/](http://www.example.com/home/?roistat_visit=1158321)). 
## Исключение из инспектирования
Например для банк-клиентов
![](Pictures/image_20250109153601.png)

![](Pictures/image_20250109153649.png)

![](Pictures/image_20250109153729.png)

2 вновь созданных результирующих правила выглядят так
![](Pictures/image_20250109154447.png)
Первым правилом мы пропускаем трафик к сайтам категории "Финансы" не производя инспекцию, вторым правилом мы дешифруем остальной трафик. 
Тут важно, что если нет или протухла лицензия, то списки URL самого UG перестают работать, поэтому настройки должны выглядеть следующим образом:
![](Pictures/image_20250109223449.png)
Журнал с байпасом инспекции трафика должен выглядеть так:
![](Pictures/image_20250109223721.png)

В политике SSL инспекции если не создано ни одного правила, то SSL не перехватывается и не дешифруются, соответственно, контент, передаваемый по SSL, не фильтруется.

# Контентная фильтрация
Это нужно для запрета или разрешения контента, передаваемого по протоколам HTTP/HTTPS, если настроено инспектирование. Напоминаю, что  использование списка URL будет работать, если есть лицензия).
![](Pictures/image_20250109230029.png)
Рассмотрим, правила из примера:
- 1 - разрешающего фильтрацию по списку URL образовательных  
- 2 - запрещающего фильтрацию по списку URL регуляторов, например РКН
- 3 - запрещающего фильтрацию по списку URL категории Threats (угрозы)
- 4 - запрет доступа к сайтам по списку URL "поисковых систем без безопасного поиска"
- 5 - запрет доступа по родительскому контролю
- 6 - запрет по морфологическим конструкциям
- 7 - запрет по срабатыванию антивирусной проверки
- 8 - предупреждение по непродуктивным сайтам
- 9 - запрет по списку РКН
- 10 - разрешение всего остального трафика 

## Пример блокирование .exe файлов
- Закладка Общие
![](Pictures/image_20250109231407.png)
- Закладка "Тип контента"
![](Pictures/image_20250109231636.png)

## Пример проверки AV
Если надо проверять весь трафик, то надо очистить вкладку "Категория URL"
![](Pictures/image_20250109232029.png)

А так можно проверить к какой категории относится URL
![](Pictures/image_20250110222128.png)
## Включение всех правил
Это можно делать, если уже включена HTTPS-инспекция (ну и настроены правильно все сертификаты )

## Тестирование 
Правило: **если что-то идет не так, то бакап, обновление, тестирование, откат к бэкапам**.
Откроем [сслыку](eicar.org) и найдем тестирование скачивания вредоносного файла
![](Pictures/image_20250109232457.png)
![](Pictures/image_20250109232716.png)
Поскольку мы ранее настроили https-инспекцию, то сработает правило антивируса и у нас при скачивании должна появиться страница заглушка. 
![](Pictures/image_20250110205547.png)
Я рассчитывал что блокировка будет по другому правилу, но получил по этому правилу. 
![](Pictures/image_20250110210212.png)
Попробую пошаманить, отключил правило
![](Pictures/image_20250110210714.png)

Если не появится, что-то пошло не так, то не хватает какой-то лицензии.
![](Pictures/image_20250109232844.png)
А вот блокировка EXE файла:
![](Pictures/image_20250113211609.png)
# Контроль приложений
полезная функция, если хотим тюнить тонко доступ к каким-либо аспектам работы того, что доступно пользователям через инет
## Создаем группу приложений
Создаем и наполняем определениями из балы UserGate
![](Pictures/image_20250113212611.png)
## Наложим ограничения на группу приложений
Свяжем группу приложений и привило межсетевого экрана
![](Pictures/image_20250113213250.png)

![](Pictures/image_20250113213407.png)

![](Pictures/image_20250113213543.png)



## Проверка
уже блокируется, с момента принудительного применения правил FW
![](Pictures/image_20250113214246.png)

![](Pictures/image_20250113214001.png)

